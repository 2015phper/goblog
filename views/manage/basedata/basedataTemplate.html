<div class="col-xs-12 col-sm-12 col-background" id="main1" style="height: 180px;">
  <div class="row">
    <div class="col-xs-4 col-sm-4">
      <h4>今日浏览量(PV)</h4>
      <h2 id="todayPV">0</h2>
      <h4>昨日浏览量(PV)</h4>
      <h2 id="yestodayPV">0</h2>
    </div>
    <div class="col-xs-4 col-sm-4">
      <h4>今日独立IP</h4>
      <h2 id="todayIP">0</h2>
      <h4>昨日独立IP</h4>
      <h2 id="yestodayIP">0</h2>
    </div>
    <div class="col-xs-4 col-sm-4">
      <h4>今日独立UV</h4>
      <h2 id="todayUV">0</h2>
      <h4>昨日独立UV</h4>
      <h2 id="yestodayUV">0</h2>
    </div>
  </div>
</div>
<div class="col-xs-12 col-sm-12 col-background" id="PV" style="min-height: 270px;"></div>
<div class="col-xs-12 col-sm-6 col-background" id="page" style="height: 270px;"></div>
<div class="col-xs-12 col-sm-6 col-background" id="engine" style="height: 270px;"></div>
<!-- <div class="col-xs-12 col-sm-6 col-background" id="mapworld" style="height: 270px;"></div> -->
<div class="col-xs-12 col-sm-6 col-background" id="mapchina" style="height: 270px;"></div>
<div class="col-xs-12 col-sm-12">
  <table class="table">
    <caption>来源链接</caption>
    <thead>
      <tr>
        <th>请求来源</th>
        <th>URL</th>
        <th>IP</th>
        <th>Time</th>
      </tr>
    </thead>
    <tbody id="tbody-latest">
    </tbody>
  </table>
</div>
<!-- 引入 ECharts 文件 -->
<script src="/static/js/echarts.min.js"></script>
<script src="/static/map/china.js"></script>
<script type="text/javascript">
  $(function(){
    window.onresize = function () {
    PV.resize(); //使第一个图表适应
    page.resize();
    engine.resize();
    mapchina.resize();
  }
});

  var baseoption = {
    baseOption:{
      title:{
        text:""
      },
      tooltip:{
        trigger:"axis",
        axisPointer:{
          animation:false
        }
      },
      legend:{
        data:[]
      },
      grid:{
        left:"3%",
        right:"4%",
        bottom:"3%",
        containLabel:true
      },
      toolbox:{
        show:true,
        feature:{
          saveAsImage:{show:true}
        }
      },
      xAxis:{
        type:"category",
        data:[],
        boundaryGap:false,
        splitLine:{
          show:false
        }
      },
      yAxis:{
        type:"value"
      },
      series:[]
    },
    media:[{
      query:{
        maxWidth:500
      },
      option:{
        legend:{
          right:"4%",
          top:"15%",
          orient:"vertical"
        }
      },
      series:[{
        radius:[20, "50%"],
        center:["50%", "30%"]
      },{
        radius:[30, "30%"],
        center:["50%", "75%"]
      }]
    }]
  }

  var mapOption = {
    title : {
        text: 'iphone销量',
        subtext: '纯属虚构',
        x:'center'
    },
    tooltip : {
        trigger: 'item'
    },
    legend: {
        orient: 'vertical',
        x:'left',
        data:['iphone3','iphone4','iphone5']
    },
    dataRange: {
        min: 0,
        max: 2500,
        x: 'left',
        y: 'bottom',
        text:['高','低'],           // 文本，默认为数值文本
        calculable : true
    },
    toolbox: {
        show: true,
        orient : 'vertical',
        x: 'right',
        y: 'center',
        feature : {
            mark : {show: true},
            dataView : {show: true, readOnly: false},
            restore : {show: true},
            saveAsImage : {show: true}
        }
    },
    roamController: {
        show: true,
        x: 'right',
        mapTypeControl: {
            'china': true
        }
    },
    series : [
        {
            name: 'iphone3',
            type: 'map',
            mapType: 'china',
            roam: false,
            itemStyle:{
                normal:{label:{show:true}},
                emphasis:{label:{show:true}}
            },
            data:[
                {name: '北京',value: Math.round(Math.random()*1000)},
                {name: '天津',value: Math.round(Math.random()*1000)},
                {name: '上海',value: Math.round(Math.random()*1000)},
                {name: '重庆',value: Math.round(Math.random()*1000)},
                {name: '河北',value: Math.round(Math.random()*1000)},
                {name: '河南',value: Math.round(Math.random()*1000)},
                {name: '云南',value: Math.round(Math.random()*1000)},
                {name: '辽宁',value: Math.round(Math.random()*1000)},
                {name: '黑龙江',value: Math.round(Math.random()*1000)},
                {name: '湖南',value: Math.round(Math.random()*1000)},
                {name: '安徽',value: Math.round(Math.random()*1000)},
                {name: '山东',value: Math.round(Math.random()*1000)},
                {name: '新疆',value: Math.round(Math.random()*1000)},
                {name: '江苏',value: Math.round(Math.random()*1000)},
                {name: '浙江',value: Math.round(Math.random()*1000)},
                {name: '江西',value: Math.round(Math.random()*1000)},
                {name: '湖北',value: Math.round(Math.random()*1000)},
                {name: '广西',value: Math.round(Math.random()*1000)},
                {name: '甘肃',value: Math.round(Math.random()*1000)},
                {name: '山西',value: Math.round(Math.random()*1000)},
                {name: '内蒙古',value: Math.round(Math.random()*1000)},
                {name: '陕西',value: Math.round(Math.random()*1000)},
                {name: '吉林',value: Math.round(Math.random()*1000)},
                {name: '福建',value: Math.round(Math.random()*1000)},
                {name: '贵州',value: Math.round(Math.random()*1000)},
                {name: '广东',value: Math.round(Math.random()*1000)},
                {name: '青海',value: Math.round(Math.random()*1000)},
                {name: '西藏',value: Math.round(Math.random()*1000)},
                {name: '四川',value: Math.round(Math.random()*1000)},
                {name: '宁夏',value: Math.round(Math.random()*1000)},
                {name: '海南',value: Math.round(Math.random()*1000)},
                {name: '台湾',value: Math.round(Math.random()*1000)},
                {name: '香港',value: Math.round(Math.random()*1000)},
                {name: '澳门',value: Math.round(Math.random()*1000)}
            ]
        },
        {
            name: 'iphone4',
            type: 'map',
            mapType: 'china',
            itemStyle:{
                normal:{label:{show:true}},
                emphasis:{label:{show:true}}
            },
            data:[
                {name: '北京',value: Math.round(Math.random()*1000)},
                {name: '天津',value: Math.round(Math.random()*1000)},
                {name: '上海',value: Math.round(Math.random()*1000)},
                {name: '重庆',value: Math.round(Math.random()*1000)},
                {name: '河北',value: Math.round(Math.random()*1000)},
                {name: '安徽',value: Math.round(Math.random()*1000)},
                {name: '新疆',value: Math.round(Math.random()*1000)},
                {name: '浙江',value: Math.round(Math.random()*1000)},
                {name: '江西',value: Math.round(Math.random()*1000)},
                {name: '山西',value: Math.round(Math.random()*1000)},
                {name: '内蒙古',value: Math.round(Math.random()*1000)},
                {name: '吉林',value: Math.round(Math.random()*1000)},
                {name: '福建',value: Math.round(Math.random()*1000)},
                {name: '广东',value: Math.round(Math.random()*1000)},
                {name: '西藏',value: Math.round(Math.random()*1000)},
                {name: '四川',value: Math.round(Math.random()*1000)},
                {name: '宁夏',value: Math.round(Math.random()*1000)},
                {name: '香港',value: Math.round(Math.random()*1000)},
                {name: '澳门',value: Math.round(Math.random()*1000)}
            ]
        },
        {
            name: 'iphone5',
            type: 'map',
            mapType: 'china',
            itemStyle:{
                normal:{label:{show:true}},
                emphasis:{label:{show:true}}
            },
            data:[
                {name: '北京',value: Math.round(Math.random()*1000)},
                {name: '天津',value: Math.round(Math.random()*1000)},
                {name: '上海',value: Math.round(Math.random()*1000)},
                {name: '广东',value: Math.round(Math.random()*1000)},
                {name: '台湾',value: Math.round(Math.random()*1000)},
                {name: '香港',value: Math.round(Math.random()*1000)},
                {name: '澳门',value: Math.round(Math.random()*1000)}
            ]
        }
    ]
};
                    
// 基于准备好的dom，初始化echarts实例
var PV = echarts.init(document.getElementById('PV'));
var page = echarts.init(document.getElementById('page'));
var engine = echarts.init(document.getElementById('engine'));
// var mapworld = echarts.init(document.getElementById('mapworld'));
var mapchina = echarts.init(document.getElementById('mapchina'));

PV.setOption(baseoption);
page.setOption(baseoption);
engine.setOption(baseoption);
// mapworld.setOption(mapOption);
mapchina.setOption(mapOption);

function hourFormat(num) {
  var hour = Math.floor(num / 6);
  if (hour < 10){
    hour = "0"+hour;
  }
  var minute = num % 6 + "0";
  return hour+":"+minute;
}
var xdataHours = new Array();
for (var i =0; i <= 144; i++){
  xdataHours[i] = hourFormat(i);
}

// 指定图表的配置项和数据
showLoading();
$.post('/admin/data', {'flag':'base'}).done(function (data) {
  hideLoading();
  var resp = JSON.parse(data);
  console.log(resp);
  if (resp.Status != success){pushMessage(resp.Err.Level, resp.Err.Msg);return;}
  $('#todayPV').text(resp.Data.PV['today']);
  $('#yestodayPV').text(resp.Data.PV['yesterday']);
  $('#todayIP').text(resp.Data.IP['today']);
  $('#yestodayIP').text(resp.Data.IP['yesterday']);
  $('#todayUV').text(resp.Data.UV['today']);
  $('#yestodayUV').text(resp.Data.UV['yesterday']);

  PV.setOption({title:{text:"日点击趋势"},legend:{data:['今日PV','昨日PV']},xAxis:{data:xdataHours,axisLabel:{interval:5,rotate: 20,margin: 15}},series:[{name:'今日PV',type:'line',data:resp.Data.TimePV['today']},{name:'昨日PV',type:'line',data:resp.Data.TimePV['yesterday']}]});
  page.setOption({title:{text:"页面排行TOP5"},xAxis:{data:xdataHours},series:[]});
  engine.setOption({title:{text:"搜索引擎TOP5"},xAxis:{data:xdataHours},series:[]});
  // mapworld.setOption({title:{text:"访客地域"},xAxis:{data:xdataHours},series:[]});
  // mapchina.setOption({title:{text:"访客地域"},xAxis:{data:xdataHours},series:[]});
  var html = '';
  if (resp.Data.Latest != null){
    for (var i = 0; i < resp.Data.Latest.length; i++){
      html += "<tr><td><a href='"+resp.Data.Latest[i].Referer+"'>"+ resp.Data.Latest[i].Referer.substring(0,30) +"...</a></td><td>"+resp.Data.Latest[i].URL+"</td><td>"+resp.Data.Latest[i].RemoteAddr+"</td><td>"+resp.Data.Latest[i].Time+"</td></tr>"
    }
  }
  $('#tbody-latest').html(html);
});
function showLoading(){
  PV.showLoading();
  page.showLoading();
  engine.showLoading();
  // mapworld.showLoading();
  mapchina.showLoading();
}

function hideLoading(){
  PV.hideLoading();
  page.hideLoading();
  engine.hideLoading();
  // mapworld.hideLoading();
  mapchina.hideLoading();
}
</script>